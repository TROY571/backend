<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.backend.mapper.SubmissionMapper">

    <resultMap id="SubmissionResultMap" type="com.example.backend.model.Submission">
        <id property="submissionId" column="submission_id" />
        <result property="assignmentId" column="assignment_id" />
        <result property="studentId" column="student_id" />
        <result property="submissionText" column="submission_text" />
        <result property="submissionFileUrl" column="submission_file_url" />
        <result property="grade" column="grade" />
        <result property="feedback" column="feedback" />
        <result property="createdAt" column="created_at" />
        <result property="updatedAt" column="updated_at" />
    </resultMap>

    <select id="findBySubmissionId" parameterType="long" resultMap="SubmissionResultMap">
        SELECT * FROM submissions WHERE submission_id = #{submissionId}
    </select>

    <select id="findByAssignmentId" parameterType="long" resultMap="SubmissionResultMap">
        SELECT * FROM submissions WHERE assignment_id = #{assignmentId}
    </select>

    <select id="findByStudentId" parameterType="long" resultMap="SubmissionResultMap">
        SELECT * FROM submissions WHERE student_id = #{studentId}
    </select>

    <insert id="insertSubmission" parameterType="com.example.backend.model.Submission" useGeneratedKeys="true" keyProperty="submissionId">
        INSERT INTO submissions (assignment_id, student_id, submission_text, submission_file_url, grade, feedback, created_at, updated_at)
        VALUES (#{assignmentId}, #{studentId}, #{submissionText}, #{submissionFileUrl}, #{grade}, #{feedback}, #{createdAt}, #{updatedAt})
    </insert>

    <update id="updateSubmission" parameterType="com.example.backend.model.Submission">
        UPDATE submissions
        SET assignment_id=#{assignmentId}, student_id=#{studentId}, submission_text=#{submissionText}, submission_file_url=#{submissionFileUrl}, grade=#{grade}, feedback=#{feedback}, updated_at=#{updatedAt}
        WHERE submission_id=#{submissionId}
    </update>

    <delete id="deleteSubmission" parameterType="long">
        DELETE FROM submissions WHERE submission_id = #{submissionId}
    </delete>
</mapper>
